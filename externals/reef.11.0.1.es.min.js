/*! Reef v11.0.1 | (c) 2021 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/reef */
let e=!1;function t(t){e&&console.warn("[Reef] "+t)}function n(e,t={},n=document){let r=new CustomEvent("reef:"+e,{bubbles:!0,cancelable:!0,detail:t});return n.dispatchEvent(r)}function r(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function o(e){let t=r(e);return"object"===t?function(){let t={};for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=o(e[n]));return t}():"array"===t?e.map((function(e){return o(e)})):e}function i(e){e._debounce&&window.cancelAnimationFrame(e.debounce),e._debounce=window.requestAnimationFrame((function(){e.render()}))}function l(e){let t=e.elem,n=o(e._store?Object.assign(e._store.data,e.data||{}):e.data);return{elem:t,data:n,template:e._template(n,t)}}function u(e){return["false","null","undefined","0","-0","NaN","0n","-0n"].includes(e)}function c(e,t){return e?new Proxy(e,function e(t){return{get:function(n,o){return"_isProxy"===o||(["object","array"].includes(r(n[o]))&&!n[o]._isProxy&&(n[o]=new Proxy(n[o],e(t))),n[o])},set:function(e,n,r){return e[n]===r||(e[n]=r,i(t)),!0},deleteProperty:function(e,n){return delete e[n],i(t),!0}}}(t)):null}let a={};var s=function(e){if(a[e.type])for(let t of a[e.type]){let{elem:n,callback:r}=t;(n===e.target||n.contains(e.target))&&r.call(t.instance,e)}};function d(e){a[e]&&(delete a[e],document.removeEventListener(e,s,!0))}function f(e,t,n,r){if(!r._listeners)return;let o=t.slice(2),i=r._listeners[n.slice(0,-2)];i&&(!function(e){a[e]||(a[e]=[],document.addEventListener(e,s,!0))}(o),function(e,t,n){return a[e].find((function(e){return t===e.elem&&n===e.callback}))}(o,e,i)||a[o].push({elem:e,callback:i,instance:r}))}function h(e,t){if(t._listeners)for(let t of e)for(let e in a)a[e]=a[e].filter((function(e){return e.elem!==t})),a[e].length||d(e)}let m=["input","option","textarea"],p=["value","checked","selected"],b=["checked","selected"];function v(e,t){let n=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!n.includes("javascript:")&&!n.includes("data:text/html"))||(!!e.startsWith("on")||void 0)}function g(e,t,n){v(t,n)||(p.includes(t)&&(e[t]="value"===t?n:" "),e.setAttribute(t,n))}function y(e,t){p.includes(t)&&(e[t]=""),e.removeAttribute(t)}function N(e,t){if(1===e.nodeType){for(let{name:n,value:r}of e.attributes){if(n.startsWith("on")&&f(e,n,r,t),v(n,r)){y(e,n);continue}if(!n.startsWith("@")&&!n.startsWith("#"))continue;let o=n.slice(1);y(e,n),b.includes(o)&&u(r)||g(e,o,r)}if(e.childNodes)for(let n of e.childNodes)N(n,t)}}function _(e){return e.childNodes&&e.childNodes.length?null:e.textContent}function w(e,t){return e.nodeType!==t.nodeType||e.tagName!==t.tagName||e.id!==t.id||e.src!==t.src}function x(e,t,n){let r=e.childNodes,o=t.childNodes;(function(e){let t=e.querySelectorAll("script");for(let e of t)e.remove()})(e)||(r.forEach((function(e,r){if(!o[r]){let r=e.cloneNode(!0);return N(r,n),void t.append(r)}if(w(e,o[r])){let t=function(e,t,n){return Array.from(t).slice(n+1).find((function(t){return!w(e,t)}))}(e,o,r);if(!t){let t=e.cloneNode(!0);return N(t,n),void o[r].before(t)}o[r].before(t)}let i=_(e);if(i&&i!==_(o[r])&&(o[r].textContent=i),function(e,t,n){if(1!==e.nodeType)return;let r=e.attributes,o=t.attributes;for(let{name:o,value:i}of r){if(o.startsWith("#"))continue;if(p.includes(o)&&m.includes(e.tagName.toLowerCase()))continue;let r=o.startsWith("@")?o.slice(1):o;b.includes(r)&&u(i)?y(t,r):o.startsWith("on")?f(t,o,i,n):g(t,r,i)}for(let{name:e,value:n}of o)r[e]||p.includes(e)&&m.includes(t.tagName.toLowerCase())||y(t,e)}(e,o[r],n),!e.childNodes.length&&o[r].childNodes.length)return h(e.children,n),void(o[r].innerHTML="");if(!o[r].childNodes.length&&e.childNodes.length){let t=document.createDocumentFragment();return x(e,t,n),void o[r].appendChild(t)}e.childNodes.length&&x(e,o[r],n)})),function(e,t,n){let r=e.length-t.length;if(!(r<1))for(;r>0;r--)h([e[e.length-1]],n),e[e.length-1].remove()}(o,r,n))}function C(e,r={}){let{data:l,store:u,template:a,isStore:s,setters:d,listeners:f,after:h}=r;if(!e&&!s)return t("Element not found.");if(!a&&!s)return t("Please provide a template function.");let m=d?o(l):c(l,this);Object.defineProperties(this,{_store:{value:u},_template:{value:a},_debounce:{value:!1,writable:!0},_isStore:{value:s},_components:s?{value:[],writable:!0}:{value:null},_listeners:{value:Object.freeze(f)},elem:{get:function(){return"string"==typeof e?document.querySelector(e):e}},data:{get:function(){return d?o(m):m},set:function(e){return d||(m=c(e,this),i(this)),!0},configurable:!0},dataCopy:{get:function(){return o(m)}},do:{value:function(e,...n){return d?d[e]?(d[e].apply(this,[m,...n]),m=o(m),void i(this)):t(`No setter named "${e}".`):t("No setters for this component.")}}}),u&&u._components.push(this),n("initialize",this)}C.prototype.html=function(){return l(this).template},C.prototype.render=function(){if(this._isStore){for(let e of this._components)"render"in e&&"function"==typeof e.render&&e.render();return}let e=l(this);return e.elem?n("before-render",{data:e.data,component:this},e.elem)?(x(function(e){let t=(new DOMParser).parseFromString(e,"text/html");return t.head&&t.head.childNodes&&t.head.childNodes.length>0&&Array.from(t.head.childNodes).reverse().forEach((function(e){t.body.insertBefore(e,t.body.firstChild)})),t.body||document.createElement("body")}(e.template),e.elem,this),n("render",{data:e.data,component:this},e.elem),e.elem):void 0:t("Render target not found.")},C.Store=function(e){return e.isStore=!0,new C(null,e)},C.debug=function(t){e=!!t},n("ready");export default C;
